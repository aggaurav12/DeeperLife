name: Deploy to Firebase Hosting 🚀

on:
  push:
    branches:
      - main  # Trigger only on `main` branch pushes

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: 📥 Checkout Repository
        uses: actions/checkout@v3

      - name: 🔧 Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 18

      - name: 🔍 Debug Secrets (Ensure Secrets are Passed)
        run: |
          echo "FIREBASE_API_KEY: ${{ secrets.FIREBASE_API_KEY }}"
          echo "FIREBASE_PROJECT_ID: ${{ secrets.FIREBASE_PROJECT_ID }}"
          echo "ADMIN_PASSWORD is set"

      - name: 📂 Create `config.js` from Secrets
        run: |
          mkdir -p public
          echo "window.ENV = {" > public/config.js
          echo "  FIREBASE_API_KEY: '${{ secrets.FIREBASE_API_KEY }}'," >> public/config.js
          echo "  FIREBASE_AUTH_DOMAIN: '${{ secrets.FIREBASE_AUTH_DOMAIN }}'," >> public/config.js
          echo "  FIREBASE_PROJECT_ID: '${{ secrets.FIREBASE_PROJECT_ID }}'," >> public/config.js
          echo "  FIREBASE_STORAGE_BUCKET: '${{ secrets.FIREBASE_STORAGE_BUCKET }}'," >> public/config.js
          echo "  FIREBASE_MESSAGING_SENDER_ID: '${{ secrets.FIREBASE_MESSAGING_SENDER_ID }}'," >> public/config.js
          echo "  FIREBASE_APP_ID: '${{ secrets.FIREBASE_APP_ID }}'" >> public/config.js
          echo "};" >> public/config.js

      - name: 🛠 Debug - Verify `config.js`
        run: |
          ls -l public/
          cat public/config.js

      - name: 🔥 Install Firebase CLI
        run: npm install -g firebase-tools

      - name: 🚀 Deploy to Firebase Hosting
        uses: FirebaseExtended/action-hosting-deploy@v0
        with:
          repoToken: "${{ secrets.GITHUB_TOKEN }}"
          firebaseServiceAccount: "${{ secrets.FIREBASE_SERVICE_ACCOUNT }}"
          channelId: live
          projectId: "${{ secrets.FIREBASE_PROJECT_ID }}"
