name: Deploy to Firebase Hosting üöÄ

on:
  push:
    branches:
      - main  # Runs when changes are pushed to `main`

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: üì• Checkout Repository
        uses: actions/checkout@v3

      - name: üîß Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 18

      - name: üî• Inject Firebase Credentials into Runtime Environment
        run: |
          mkdir -p peak_life_index_design
          cat <<EOT > peak_life_index_design/.env
          VITE_FIREBASE_API_KEY="${{ secrets.FIREBASE_API_KEY }}"
          VITE_FIREBASE_AUTH_DOMAIN="${{ secrets.FIREBASE_AUTH_DOMAIN }}"
          VITE_FIREBASE_PROJECT_ID="${{ secrets.FIREBASE_PROJECT_ID }}"
          VITE_FIREBASE_STORAGE_BUCKET="${{ secrets.FIREBASE_STORAGE_BUCKET }}"
          VITE_FIREBASE_MESSAGING_SENDER_ID="${{ secrets.FIREBASE_MESSAGING_SENDER_ID }}"
          VITE_FIREBASE_APP_ID="${{ secrets.FIREBASE_APP_ID }}"
          EOT

      - name: üõ† Verify `.env` File Exists
        run: |
          ls -l peak_life_index_design/.env || echo "‚ö†Ô∏è .env NOT FOUND!"
          cat peak_life_index_design/.env || echo "‚ö†Ô∏è Unable to read .env!"

      - name: üî• Install Firebase CLI
        run: npm install -g firebase-tools

      - name: üöÄ Deploy to Firebase Hosting
        uses: FirebaseExtended/action-hosting-deploy@v0
        with:
          repoToken: "${{ secrets.GITHUB_TOKEN }}"
          firebaseServiceAccount: "${{ secrets.FIREBASE_SERVICE_ACCOUNT }}"
          channelId: live
          projectId: deeperlife-1221
